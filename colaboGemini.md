# Claude Code & Gemini CLI 連携・自動設定指示書
# バージョン: 3.3

## 概要
このファイルは、AIアシスタント（Claude Code等）がGemini CLIとの連携環境を自動設定するための指示書です。
「colabo.mdに従ってください」と指示すると、以下のタスクが冪等性（何度実行しても同じ結果になる性質）を保ちながら自動的に実行されます。

---

## STEP 1: 環境チェック

### 1.1 Gemini CLIの存在確認
- **目的**: Gemini CLIが実行可能か確認する。
- **アクション**: `Bash`ツールでコマンド実行
- **コマンド**: `gemini --version`
- **成功条件**:
  1. コマンドの終了コードが0である。
  2. 標準出力が正規表現 `\d+\.\d+\.\d+` にマッチする文字列を含む。
  3. 出力が空でない。
- **失敗時**: 
  - コマンドが見つからない場合: 「エラー: geminiコマンドが見つかりません。インストールとパス設定を確認してください。」と報告して停止する。
  - その他のエラー: 「エラー: Gemini CLIの実行に失敗しました。処理を中断します。」と報告して停止する。

### 1.2 連携ファイルの存在確認
- **目的**: 連携に必要な設定ファイルの有無を確認する。
- **アクション**: `LS`ツールでファイルリスト取得
- **確認対象**: カレントディレクトリ
- **成功条件**: ファイルリストが正常に取得できる。
- **失敗時**: 「エラー: カレントディレクトリのファイルリストを取得できません。パーミッションを確認してください。」と報告して停止する。
- **後続処理への指示**: 出力されたファイルリストを記憶し、STEP 2の各ファイル作成ステップの実行判断に利用する。

---

## STEP 2: 連携ファイルの生成

### 2.1 CLAUDE.mdの作成
- **実行条件**: STEP 1.2で取得したファイルリストに `CLAUDE.md` が **含まれない場合のみ** 実行する。
- **アクション**: `Write`ツールでファイル作成
- **ファイル名**: `CLAUDE.md`
- **内容**: 以下の内容をそのまま書き込む
```
# Claude Code ガイダンス

このリポジトリで作業する際は、必ず日本語でレスポンスしてください。

## Gemini CLI 連携

ユーザーが「Geminiと連携」「Geminiと相談」と指示した場合、Gemini CLIを呼び出して協業してください。

### ワークフロー
1. ユーザーの質問を基に、Geminiへのプロンプトを準備
2. `gemini <<EOF\n[プロンプト]\nEOF` の形式でコマンドを実行
3. Geminiの応答を **Gemini ➜** セクションに表示
4. あなたの見解を **Claude ➜** セクションに追加
5. 必要に応じて1-4を繰り返し

### 形式
```md
**Gemini ➜**
<Geminiからの応答>
**Claude ➜**
<統合コメント & 次アクション>
```
```
- **失敗時**: 「エラー: CLAUDE.mdの作成に失敗しました。書き込み権限を確認してください。」と報告して停止する。

### 2.2 Gemini.mdの作成
- **実行条件**: STEP 1.2で取得したファイルリストに `Gemini.md` が **含まれない場合のみ** 実行する。
- **アクション**: `Write`ツールでファイル作成
- **ファイル名**: `Gemini.md`
- **内容**: 以下の内容をそのまま書き込む
```
# Gemini AI 連携ガイド

このプロジェクトについてGeminiに伝えるべき情報を記述してください。

## プロジェクト概要
（例：このリポジトリは、〇〇を実現するためのプロジェクトです。）

## 技術スタック
（例：言語、フレームワーク、ツール等）

## 重要なルール
（例：命名規則、コーディング規約、設計方針等）
```
- **失敗時**: 「エラー: Gemini.mdの作成に失敗しました。書き込み権限を確認してください。」と報告して停止する。

---

## STEP 3: 連携テストと完了報告

### 3.1 連携テスト
- **目的**: ファイルが作成され、Gemini CLIが応答するか最終確認する。
- **アクション**: `Bash`ツールでコマンド実行
- **コマンド**: 
```bash
gemini <<EOF
連携テストです。「OK」と返信してください。
EOF
```
- **成功条件**:
  1. コマンドの終了コードが0である。
  2. 標準出力に「OK」が含まれる。

### 3.2 完了報告
- **STEP 3.1 成功時**: 「✅ Gemini CLIとの連携が設定されました。『Geminiと連携』または『Geminiと相談』と話しかけてください。」と報告する。
- **STEP 3.1 失敗時**: 
    - コマンド実行自体が失敗した場合: 「エラー: 連携テストコマンドの実行に失敗しました。」と報告する。
    - 応答内容が期待と異なる場合: 「エラー: 連携テストは成功しましたが、期待する応答が得られませんでした。」と報告する。

---

## 実行時の注意事項
- 各STEPは記載された順番に実行してください。
- エラーが発生した場合は、その時点で処理を停止し、具体的なエラー内容をユーザーに報告してください。
- ファイル作成は、対象ファイルが存在しない場合にのみ実行し、既存のファイルを上書きしないでください。
- 各コマンド実行後、予期しないエラー出力がある場合は報告してください。